# ППО

## Название проекта
Sigma Music

## Краткое описание идеи проекта
Сервис для прослушивания музыки, позволяет прослушивать музыку пользователям и загружать музыку исполнителям.
Пользователи могут добавлять музыку в избранное и оставлять комментарии. Исполнители загружают создают альбомы и выкладывают музыку.
Чтобы пользователь мог прослушивать музыку без ограничений, ему необходимо преобрести подписку.

## Краткое описание предметной области

Предметная область - музыкальный сервис.

Сервис потоковой передачи музыки - это тип сервиса потокового мультимедиа, который фокусируется в основном на музыке, а иногда и на других формах цифрового аудиоконтента, таких как подкасты.
Такие сервисы обычно являются сервисами на основе подписки.
Некоторые сервисы могут предлагать бесплатные уровни с ограничениями, такими как реклама и ограничения на использование.

## Краткий анализ аналогичных решений по 4 критериям

|Решение|Пользовательский отчет|Доступность оплаты в России|Наличие комментариев|
|---|---|---|---|
|Sigma Music|+|+|+|
|Yandex Music|+|+|-|
|Spotify|+|-|-|
|VK Music|+|+|-|

## Актуальность
Стриминговые сервисы для прослушивания музыки становятся все более популярными среди музыкальных потребителей, их актуальность в настоящее время трудно переоценить. Вместо скачивания отдельных треков или альбомов пользователи могут получить доступ к огромной библиотеке музыки практически любого жанра прямо на своих устройствах.
Одним из главных преимуществ стриминговых сервисов является удобство использования. Пользователи могут слушать музыку на ходу, создавать плейлисты, делиться музыкой с друзьями.
Таким образом, стриминговые сервисы для прослушивания музыки являются удобным, доступным и разнообразным способом наслаждаться любимыми композициями в любое время и в любом месте.

## Описание ролей
**Гость** - неавторизованный пользователь, который может лишь посмотреть информацию об исполнителе, авторизоваться, зарегистрироваться.

**Пользователь** - авторизованный, может может прослушивать музыку без ограничений.

**Исполнитель** - пользователь, который может загружать свои треки.

## Use-Case диаграмма

![Use-case](docs/pics/use-cases.svg)

## ER диаграмма

![ER](docs/pics/er.svg)

## Диаграмма базы данных

![DB](docs/pics/db.svg)

## Сложные сценарии

#### Формирование отчета
1. Пользователь отправляет запрос на формирование отчета;
2. Формируется упорядоченный список исполнителей, которых слушал пользователь;
3. Формируется список жанров, которые слушал пользователь;
4. Рассчитывается количество прослушиваний пользователем, каждого жанра;
5. Рассчитывается процентное соотношение прослушивания каждого жанра;
6. Вычисляется общее число прослушиваний пользователя;
7. Ответ на запрос возвращается пользователю.

[//]: # (#### Оформление подписки  )

[//]: # (1. Пользователь выбирает план подписки;)

[//]: # (2. Генерируется ссылка для оплаты с параметрами идентификации пользователя и платежа;)

[//]: # (3. Пользователь перенаправляется на страницу оплаты;)

[//]: # (4. Пользователь вводит платежные данные;)

[//]: # (5. Платежная система реализует нужный сценарий подтверждения оплаты &#40;например, перенаправляет пользователя в интернет-банк&#41;;)

[//]: # (6. Пользователь подтверждает оплату;)

[//]: # (7. Возвращает пользователя на страницу завершения оплаты на стороне сервиса.)

#### Авторизация пользователей при входе
1. Пользователь вводит логин и пароль;
2. Создается пара JWT токенов - access токен и refresh токен;
3. Создается новая сессия;
4. Сессия помещается в redis;
5. Пользователю возвращется пара JWT токенов.

## Пользовательские сценарии

**Гость** может:
- просмотреть информацию об исполнителе;
- авторизоваться;
- зарегистрироваться.

После авторизации гость становится *пользователем*.

**Пользователь** может:
- просмотреть информацию об исполнителе;
- прослушивать треки;
- добавлять треки в избранное;
- оставлять комментарии.

**Исполнитель** может:
- загрузить трек;
- создать альбом;
- добавлять информацию о себе;

## BPMN-диаграмма

![BPMN](docs/pics/bpmn.png)


## Экраны веб приложения

![WEB](docs/pics/web.svg)

## Нагрузочное тестирование

Запуск тестирования с Apache Benchmark

### Запуск с двумя дополнительными инстансами

```
ab -k -n 1000 -c 10 -l 'http://localhost/api/v1/users/'


Server Software:        nginx
Server Hostname:        localhost
Server Port:            80

Document Path:          /api/v1/users/
Document Length:        Variable

Concurrency Level:      10
Time taken for tests:   1.173 seconds
Complete requests:      1000
Failed requests:        0
Keep-Alive requests:    0
Total transferred:      158521000 bytes
HTML transferred:       158343000 bytes
Requests per second:    852.54 [#/sec] (mean)
Time per request:       11.730 [ms] (mean)
Time per request:       1.173 [ms] (mean, across all concurrent requests)
Transfer rate:          131977.51 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.3      0       5
Processing:     3   11   4.9     10      50
Waiting:        2    9   4.6      8      45
Total:          4   11   4.9     10      51

Percentage of the requests served within a certain time (ms)
  50%     10
  66%     12
  75%     13
  80%     14
  90%     17
  95%     20
  98%     23
  99%     29
 100%     51 (longest request)
 ```

### Запуск одного инстанса

```
Server Software:        nginx
Server Hostname:        localhost
Server Port:            80

Document Path:          /api/v1/users/
Document Length:        Variable

Concurrency Level:      10
Time taken for tests:   1.285 seconds
Complete requests:      1000
Failed requests:        0
Keep-Alive requests:    0
Total transferred:      158521000 bytes
HTML transferred:       158343000 bytes
Requests per second:    778.19 [#/sec] (mean)
Time per request:       12.850 [ms] (mean)
Time per request:       1.285 [ms] (mean, across all concurrent requests)
Transfer rate:          120468.33 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    0   0.0      0       0
Processing:     3   13   4.9     11      34
Waiting:        2   11   4.8      9      33
Total:          3   13   4.9     12      34

Percentage of the requests served within a certain time (ms)
  50%     12
  66%     15
  75%     16
  80%     17
  90%     19
  95%     21
  98%     23
  99%     25
 100%     34 (longest request)
 ```
